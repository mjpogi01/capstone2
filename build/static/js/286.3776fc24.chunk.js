(self.webpackChunkcapstone=self.webpackChunkcapstone||[]).push([[286],{6905:(t,e,a)=>{"use strict";a.r(e),a.d(e,{default:()=>b});var s=a(2555),i=a(5043),n=a(9896),r=a(9419),o=a(2023),c=a(3986),l=a(7401),h=a(576),d=a(3391);var u=a(228),m=a.n(u);const p=["center","children"],f=(0,l.Lt)(function(t,e){let{center:a,children:s}=t,i=(0,c.A)(t,p);const n=new u.CircleMarker(a,i);return(0,h.Q)(n,(0,d.W4)(e,{overlayContainer:n}))},function(t,e,a){e.center!==a.center&&t.setLatLng(e.center),null!=e.radius&&e.radius!==a.radius&&t.setRadius(e.radius)}),_=(0,l.wk)(function(t,e){const a=new u.Tooltip(t,e.overlayContainer);return(0,h.Q)(a,e)},function(t,e,a,s){let{position:n}=a;(0,i.useEffect)(function(){const a=e.overlayContainer;if(null==a)return;const{instance:i}=t,r=t=>{t.tooltip===i&&(null!=n&&i.setLatLng(n),i.update(),s(!0))},o=t=>{t.tooltip===i&&s(!1)};return a.on({tooltipopen:r,tooltipclose:o}),a.bindTooltip(i),function(){a.off({tooltipopen:r,tooltipclose:o}),null!=a._map&&a.unbindTooltip()}},[t,e,s,n])});var g=a(184),y=(a(6433),a(4227)),v=a(7726),x=(a(9e3),a(579));if(m().HeatLayer&&"function"===typeof m().HeatLayer.prototype._initCanvas){const t=m().HeatLayer.prototype._initCanvas;m().HeatLayer.prototype._initCanvas=function(){if(t.call(this),this._canvas&&this._canvas.getContext){const t=this._canvas.getContext("2d",{willReadFrequently:!0})||this._canvas.getContext("2d");t&&(this._ctx=t)}}}if(m().HeatLayer&&"function"===typeof m().HeatLayer.prototype._clear){const t=m().HeatLayer.prototype._clear;m().HeatLayer.prototype._clear=function(){if(this._canvas){if(!this._ctx)try{const t=this._canvas.getContext("2d",{willReadFrequently:!0})||this._canvas.getContext("2d");if(!t)return;this._ctx=t}catch(e){return}if(this._ctx&&"function"===typeof this._ctx.clearRect)try{t.call(this)}catch(a){}}}}if(m().HeatLayer&&"function"===typeof m().HeatLayer.prototype._redraw){const t=m().HeatLayer.prototype._redraw;m().HeatLayer.prototype._redraw=function(){if(this._canvas){if(!this._ctx){if(this._initCanvas)try{this._initCanvas()}catch(e){}if(!this._ctx)try{const t=this._canvas.getContext("2d",{willReadFrequently:!0})||this._canvas.getContext("2d");if(!t)return;this._ctx=t}catch(e){return}}if(this._ctx&&"function"===typeof this._ctx.clearRect)try{t.call(this)}catch(a){}}}}function L(t){let{points:e,shouldFit:a}=t;const s=(0,n.ko)(),r=i.useRef(!1);return(0,i.useEffect)(()=>{if(a&&!r.current&&e&&e.length>0){const t=e.map(t=>[t[0],t[1]]),a=m().latLngBounds(t);s.fitBounds(a,{padding:[50,50]}),r.current=!0}},[s,e,a]),null}function w(t){let{points:e,visible:a}=t;const s=(0,n.ko)(),r=i.useRef(null),o=i.useRef(!1);return(0,i.useEffect)(()=>{if(!s)return;s&&s.getContainer()&&s._loaded?o.current=!0:o.current=!1;const t=()=>{o.current=!0};s.on("load",t),s._loaded&&(o.current=!0);const i=()=>{const t=r.current;if(t){try{t.setLatLngs&&t.setLatLngs([])}catch(e){}if(s.hasLayer(t))try{s.removeLayer(t)}catch(e){}try{t._canvas&&t._canvas.parentNode&&(t._canvas.style.display="none")}catch(e){}try{if(t._canvas&&t._ctx&&"function"===typeof t._ctx.clearRect){t._ctx.clearRect(0,0,t._canvas.width,t._canvas.height)}}catch(e){}r.current=null}},n=()=>{if(!a)return void i();if(!o.current)return void setTimeout(n,100);const t=(()=>{if(!r.current)try{const t=m().heatLayer([],{radius:20,blur:28,maxZoom:11,minOpacity:.35,gradient:{0:"#fee2e2",.45:"#fca5a5",.65:"#f87171",.85:"#ef4444",1:"#b91c1c"}});r.current=t}catch(t){return console.warn("Error creating heat layer:",t),null}return r.current})();if(!t)return;if(!s||!s.getContainer())return;if(!s._loaded&&!s._container)return void setTimeout(n,100);const c=Array.isArray(e)&&e.length>0?e:[];requestAnimationFrame(()=>{try{const i=null===s||void 0===s?void 0:s.getContainer();if(!i||!i.parentNode)return void setTimeout(n,100);if(!t._canvas||t._ctx&&t._canvas.getContext||t._initCanvas&&t._initCanvas(),t._canvas&&(t._canvas.style.display=""),s.hasLayer(t))t.setLatLngs(c);else if(s._panes&&s._panes.overlayPane&&s._panes.overlayPane.parentNode)try{const a=s._panes.overlayPane.parentNode,i=s.getContainer();if(a&&a.appendChild&&i&&null!==i.offsetParent)try{t.setLatLngs(c),t.addTo(s)}catch(e){if(!e.message||!e.message.includes("appendChild"))throw e;setTimeout(n,200)}else setTimeout(n,100)}catch(a){setTimeout(n,100)}else setTimeout(n,100)}catch(i){i.message&&i.message.includes("appendChild")&&setTimeout(n,200)}})},c=setTimeout(()=>{n()},100);return()=>{clearTimeout(c),i(),s&&s.off("load",t)}},[s,e,a]),null}delete m().Icon.Default.prototype._getIconUrl,m().Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"});const b=t=>{let{onDataLoaded:e}=t;const[a,n]=(0,i.useState)([]),[c,l]=(0,i.useState)([]),[h,d]=(0,i.useState)([]),[u,m]=(0,i.useState)(!0),[p,b]=(0,i.useState)(!0),[C,j]=(0,i.useState)(!0),[N,A]=(0,i.useState)(!1),k=(0,i.useCallback)(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("function"===typeof e){const n=Array.isArray(a)?a.reduce((t,e)=>t+(Number(e.count)||0),0):0;e({points:t,cityStats:a,summary:(0,s.A)({totalPoints:Array.isArray(t)?t.length:0,totalCities:Array.isArray(a)?a.length:0,totalCustomers:n,topCity:Array.isArray(a)&&a.length?a[0].city:null},i)})}},[e]);(0,i.useEffect)(()=>{T()},[]);const T=async()=>{try{m(!0),k([],[],{status:"loading"});const t=await(0,v.t)("".concat(y.API_URL,"/api/analytics/customer-locations"));if(t.ok){const e=await t.json();if(e.success&&e.data){const t=Array.isArray(e.data)?e.data:[],a=Array.isArray(e.markers)?e.markers:[],s=[...Array.isArray(e.cityStats)?e.cityStats:[]].sort((t,e)=>(Number(e.count)||0)-(Number(t.count)||0));n(t),d(s),l(a),k(t,s,{status:"loaded",source:"api"}),console.log("\u2705 Loaded ".concat(t.length," customer location points from database")),!N&&t.length>0&&A(!0)}else n([]),d([]),k([],[],{status:"loaded",source:"api",empty:!0}),console.log("\u2139\ufe0f No customer location data available")}else{const e=await t.json().catch(()=>({}));console.error("\u274c API error fetching customer locations:",e),n([]),d([]),k([],[],{status:"error",source:"api",error:e.error||"Failed to fetch customer locations"})}}catch(t){console.error("\u274c Error fetching customer locations:",t),n([]),d([]),k([],[],{status:"error",source:"api",error:t.message||"Network error"})}finally{m(!1)}},R=(0,i.useMemo)(()=>a&&0!==a.length?a.map(t=>[t[0],t[1],"number"===typeof t[2]?t[2]:1]):[],[a]);if(u)return(0,x.jsxs)("div",{className:"branch-map-loading",children:[(0,x.jsx)("div",{className:"loading-spinner"}),(0,x.jsx)("p",{children:"Loading map..."})]});if(!u&&0===a.length&&0===h.length)return(0,x.jsxs)("div",{className:"branch-map-container",children:[(0,x.jsx)("div",{className:"branch-map-header",children:(0,x.jsxs)("div",{children:[(0,x.jsxs)("h3",{children:[(0,x.jsx)(g.YXz,{className:"header-icon"}),"Customer Locations"]}),(0,x.jsx)("p",{children:"No customer location data available"})]})}),(0,x.jsxs)("div",{className:"branch-map-empty-state",children:[(0,x.jsx)(g.A4L,{className:"empty-icon"}),(0,x.jsx)("p",{children:"No customer locations found in the database."}),(0,x.jsx)("p",{className:"empty-subtitle",children:"Customer locations will appear here once customers add addresses or place orders."})]})]});return(0,x.jsxs)("div",{className:"branch-map-container",children:[(0,x.jsxs)("div",{className:"branch-map-header",children:[(0,x.jsxs)("div",{children:[(0,x.jsxs)("h3",{children:[(0,x.jsx)(g.YXz,{className:"header-icon"}),"Customer Locations"]}),(0,x.jsx)("p",{children:"Visualize customer density with heatmap and red dot markers"})]}),(0,x.jsxs)("div",{className:"branch-map-controls",children:[(0,x.jsxs)("label",{className:"map-toggle",children:[(0,x.jsx)("input",{type:"checkbox",checked:p,onChange:()=>b(t=>!t)}),(0,x.jsx)("span",{className:"toggle-slider"}),(0,x.jsx)("span",{className:"toggle-label",children:(0,x.jsx)("span",{className:"toggle-text",children:"Heatmap"})})]}),(0,x.jsxs)("label",{className:"map-toggle",children:[(0,x.jsx)("input",{type:"checkbox",checked:C,onChange:()=>j(t=>!t)}),(0,x.jsx)("span",{className:"toggle-slider"}),(0,x.jsx)("span",{className:"toggle-label",children:(0,x.jsx)("span",{className:"toggle-text",children:"Red Dots"})})]})]})]}),(0,x.jsx)("div",{className:"branch-map-wrapper",children:(0,x.jsxs)(r.W,{center:[13.7563,121.0583],zoom:9,style:{height:"600px",width:"100%",borderRadius:"12px"},scrollWheelZoom:!0,preferCanvas:!0,children:[(0,x.jsx)(o.e,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),(0,x.jsx)(L,{points:a,shouldFit:!N&&a.length>0}),(0,x.jsx)(w,{points:R,visible:p}),C&&a.map((t,e)=>{const a=c[e]||c.find(e=>e&&"object"===typeof e&&Math.abs(e.lat-t[0])<1e-4&&Math.abs(e.lng-t[1])<1e-4),s=a&&"object"===typeof a?a.customerName:null;return(0,x.jsx)(f,{center:[t[0],t[1]],radius:4,pathOptions:{fillColor:"#ef4444",color:"#dc2626",fillOpacity:.8,weight:1},children:s&&(0,x.jsx)(_,{permanent:!1,direction:"top",offset:[0,-10],children:s})},e)})]})}),(0,x.jsxs)("div",{className:"branch-map-legend",children:[(0,x.jsx)("h4",{children:"Top Customer Cities"}),(0,x.jsx)("div",{className:"legend-items",children:h.slice(0,10).map((t,e)=>(0,x.jsxs)("div",{className:"legend-item",children:[(0,x.jsx)("div",{className:"legend-marker",style:{backgroundColor:["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6"][e%5]}}),(0,x.jsx)("span",{className:"legend-city",children:t.city}),(0,x.jsxs)("span",{className:"legend-count",children:["(",Number(t.count||0).toLocaleString()," customers)"]})]},e))})]})]})}},9e3:()=>{!function(){"use strict";function t(e){return this instanceof t?(this._canvas=e="string"==typeof e?document.getElementById(e):e,this._ctx=e.getContext("2d"),this._width=e.width,this._height=e.height,this._max=1,void this.clear()):new t(e)}t.prototype={defaultRadius:25,defaultGradient:{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},data:function(t,e){return this._data=t,this},max:function(t){return this._max=t,this},add:function(t){return this._data.push(t),this},clear:function(){return this._data=[],this},radius:function(t,e){e=e||15;var a=this._circle=document.createElement("canvas"),s=a.getContext("2d"),i=this._r=t+e;return a.width=a.height=2*i,s.shadowOffsetX=s.shadowOffsetY=200,s.shadowBlur=e,s.shadowColor="black",s.beginPath(),s.arc(i-200,i-200,t,0,2*Math.PI,!0),s.closePath(),s.fill(),this},gradient:function(t){var e=document.createElement("canvas"),a=e.getContext("2d"),s=a.createLinearGradient(0,0,0,256);for(var i in e.width=1,e.height=256,t)s.addColorStop(i,t[i]);return a.fillStyle=s,a.fillRect(0,0,1,256),this._grad=a.getImageData(0,0,1,256).data,this},draw:function(t){this._circle||this.radius(this.defaultRadius),this._grad||this.gradient(this.defaultGradient);var e=this._ctx;e.clearRect(0,0,this._width,this._height);for(var a,s=0,i=this._data.length;i>s;s++)a=this._data[s],e.globalAlpha=Math.max(a[2]/this._max,t||.05),e.drawImage(this._circle,a[0]-this._r,a[1]-this._r);var n=e.getImageData(0,0,this._width,this._height);return this._colorize(n.data,this._grad),e.putImageData(n,0,0),this},_colorize:function(t,e){for(var a,s=3,i=t.length;i>s;s+=4)(a=4*t[s])&&(t[s-3]=e[a],t[s-2]=e[a+1],t[s-1]=e[a+2])}},window.simpleheat=t}(),L.HeatLayer=(L.Layer?L.Layer:L.Class).extend({initialize:function(t,e){this._latlngs=t,L.setOptions(this,e)},setLatLngs:function(t){return this._latlngs=t,this.redraw()},addLatLng:function(t){return this._latlngs.push(t),this.redraw()},setOptions:function(t){return L.setOptions(this,t),this._heat&&this._updateOptions(),this.redraw()},redraw:function(){return!this._heat||this._frame||this._map._animating||(this._frame=L.Util.requestAnimFrame(this._redraw,this)),this},onAdd:function(t){this._map=t,this._canvas||this._initCanvas(),t._panes.overlayPane.appendChild(this._canvas),t.on("moveend",this._reset,this),t.options.zoomAnimation&&L.Browser.any3d&&t.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(t){t.getPanes().overlayPane.removeChild(this._canvas),t.off("moveend",this._reset,this),t.options.zoomAnimation&&t.off("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},_initCanvas:function(){var t=this._canvas=L.DomUtil.create("canvas","leaflet-heatmap-layer leaflet-layer"),e=L.DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","msTransformOrigin"]);t.style[e]="50% 50%";var a=this._map.getSize();t.width=a.x,t.height=a.y;var s=this._map.options.zoomAnimation&&L.Browser.any3d;L.DomUtil.addClass(t,"leaflet-zoom-"+(s?"animated":"hide")),this._heat=simpleheat(t),this._updateOptions()},_updateOptions:function(){this._heat.radius(this.options.radius||this._heat.defaultRadius,this.options.blur),this.options.gradient&&this._heat.gradient(this.options.gradient),this.options.max&&this._heat.max(this.options.max)},_reset:function(){var t=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(this._canvas,t);var e=this._map.getSize();this._heat._width!==e.x&&(this._canvas.width=this._heat._width=e.x),this._heat._height!==e.y&&(this._canvas.height=this._heat._height=e.y),this._redraw()},_redraw:function(){var t,e,a,s,i,n,r,o,c,l=[],h=this._heat._r,d=this._map.getSize(),u=new L.Bounds(L.point([-h,-h]),d.add([h,h])),m=void 0===this.options.max?1:this.options.max,p=void 0===this.options.maxZoom?this._map.getMaxZoom():this.options.maxZoom,f=1/Math.pow(2,Math.max(0,Math.min(p-this._map.getZoom(),12))),_=h/2,g=[],y=this._map._getMapPanePos(),v=y.x%_,x=y.y%_;for(t=0,e=this._latlngs.length;e>t;t++)if(a=this._map.latLngToContainerPoint(this._latlngs[t]),u.contains(a)){i=Math.floor((a.x-v)/_)+2,n=Math.floor((a.y-x)/_)+2,c=(void 0!==this._latlngs[t].alt?this._latlngs[t].alt:void 0!==this._latlngs[t][2]?+this._latlngs[t][2]:1)*f,g[n]=g[n]||[],(s=g[n][i])?(s[0]=(s[0]*s[2]+a.x*c)/(s[2]+c),s[1]=(s[1]*s[2]+a.y*c)/(s[2]+c),s[2]+=c):g[n][i]=[a.x,a.y,c]}for(t=0,e=g.length;e>t;t++)if(g[t])for(r=0,o=g[t].length;o>r;r++)(s=g[t][r])&&l.push([Math.round(s[0]),Math.round(s[1]),Math.min(s[2],m)]);this._heat.data(l).draw(this.options.minOpacity),this._frame=null},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),a=this._map._getCenterOffset(t.center)._multiplyBy(-e).subtract(this._map._getMapPanePos());L.DomUtil.setTransform?L.DomUtil.setTransform(this._canvas,a,e):this._canvas.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(a)+" scale("+e+")"}}),L.heatLayer=function(t,e){return new L.HeatLayer(t,e)}}}]);
//# sourceMappingURL=286.3776fc24.chunk.js.map